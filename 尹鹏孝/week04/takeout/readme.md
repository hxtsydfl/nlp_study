# 说明文档 #

[//]: # (abs测试地址：备注)
E:\成长和学习\学习\learning\server\httpd-2.4.65-250724-Win64-VS17\Apache24\bin>abs.exe -n 5  -c 1  -p data.json -T application/json  http://localhost:8000/bert-takeout-evaluation-results
## 基本大流程：
### 1、配置conda和切换环境到当前的环境
### 2、配置uv环境，配置uv环境
### 3、创建文件夹各个文件夹的目录的含义
    ### 1）assets:负责放置数据集，和modelscope(hugging face)模型数据，一般需要torch和基本数据，在此处入坑一次没下载依赖文件导致跑不起来；weights放置训练好的模型包
    ### 2）doc文件用于放置文件的说明和运维相关说明
    ### 3）model模型主要是写代码实现业务逻辑提供接口的模型，比如使用了bert模型那这个bert.py文件就是要实现相关的业务逻辑，里面包括加载训练好的模型，定义数据集，模型转数据提供给fastapi使用流程
    ### 4）test主要放置测试相关的数据，和测试结果，截图之类的
    ### 5）train_code主要放置生成模型包的代码，这是机器学习的核心流程在此文件夹。
        #### 大语言模型生成模型的基本流程
        #### # -------------------------- 1. 数据准备 --------------------------
                包括加载本地数据、选取适当样本、产生训练集，测试集和相关的标签、加载模型所需的插件和分词器生成输入数据：train_encoding、test_encoding

        #### # -------------------------- 2. 数据集和数据加载器 --------------------------
               自定义数据集类，继承自PyTorch的Dataset 、用于处理编码后的数据和标签，方便后续批量读取主要包括：__init__、__getitem__、__len__
                # 实例化自定义数据集设置样本和模型加载器# 使用DataLoader创建批量数据加载器、batch_size=16：每个批次包含16个样本、shuffle=True：在每个epoch开始时打乱数据，以提高模型泛化能力
        #### # -------------------------- 3. 模型和优化器 --------------------------
                # 加载BERT用于序列分类的预训练模型 num_labels=17：指定分类任务的类别数量 BertForSequenceClassification全连接文本分类、设置设备，优先使用CUDA（GPU），否则使用CPU
                # 定义优化器，使用AdamW，lr是学习率
                # 定义精度计算函数
                
        #### # -------------------------- 4. 训练和验证函数 --------------------------
                # 定义训练函数
                    # 设置模型为训练模式
                    # 遍历训练数据加载器
                        # 清除上一轮的梯度
                        # 将批次数据移动到指定设备
                        # 执行前向传播，得到损失和logits
                        # 反向传播计算梯度
                        # 梯度裁剪，防止梯度爆炸
                        # 更新模型参数
                        # 每100步打印一次训练进度
                    # 打印平均训练损失
                # 定义验证函数
                    # 设置模型为评估模式
                    # 遍历测试数据加载器
                        # 在验证阶段，不计算梯度with torch.no_grad():
                            # 将批次数据移动到指定设备
                            # 执行前向传播
                        # 将logits和标签从GPU移动到CPU，并转换为numpy数组
                # 计算平均准确率
            
        #### # -------------------------- 5. 主训练循环 --------------------------

        # 循环训练4个epoch

        #### # -------------------------- 6. 输出模型 --------------------------
                # 输出模型供model模块使用
                torch.save(model.state_dict(), '../assets/weights/bert.pkl')
    ### 6) app.log是main.py的日志。config.py是数据配置，conda.bat是输出conda输出requirement.txt环境
    ### 7) data_shchema.py是相关的校验数据类
    ### 8) logger.py日志配置文件，
    ### 9) main.py是程序入口文件
    ### 10) requirements.py是uv依赖入口文件.venv\Scripts\activate 
    ### 11) .venv文件夹是uv uvivorn依赖入口文件:uvicorn main:app --reload --host 127.0.0.1 --port 8000