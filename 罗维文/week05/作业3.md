## rag实现大致概括
1. 知识库 -> 提取文本 -> 划分段落区块chunk -> 文本嵌入到向量库
2. 输入的问题 -> 问题的嵌入向量 -> 与向量库做相似匹配
3. 匹配得到的知识库原文 -> 通过编写提示词(包含原文和问题) -> 发送给大模型
4. 得到输出
## 准备工作
1. router_schemas：API 请求和响应的数据结构
2. es_api：Elasticsearch配置连接
3. rag_api：RAG 逻辑
4. db_api：数据库
5. main：主程序
## 实现
### 1. router_schemas
 * **EmbeddingRequest(BaseModel)**:  
/v1/embedding 端接收的 JSON 数据格式  
 * **EmbeddingResponse(BaseModel)**:  
/v1/embedding 端返回的 JSON 数据格式  
 * **RerankRequest(BaseModel)**:  
/v1/rerank 端接收的 JSON 数据格式  
 * **RerankResponse(BaseModel)**:  
/v1/rerank 端返回的 JSON 数据格式
 * **KnowledgeRequest(BaseModel)**:  
创建知识库 (POST /v1/knowledge_base) 时客户端需要提供的 JSON 数据格式
 * **KnowledgeResponse(BaseModel)**:  
与知识库操作相关的 API 端点（GET, POST, DELETE /v1/knowledge_base）返回的 JSON 数据格式
 * **DocumentRequest(BaseModel)**:  
创建文档时客户端需要提供的 JSON 数据格式（暂未用）
 * **DocumentResponse(BaseModel)**:  
与文档操作相关的 API 端点（GET, DELETE /v1/document 和 POST /v1/document）返回的 JSON 数据格式
 * **RAGRequest(BaseModel)**:  
/chat 端点期望接收的 JSON 数据格式
 * **RAGResponse(BaseModel)**:  
/chat 端点返回的 JSON 数据格式

#### 2. es_api
 * 从配置中提取 Elasticsearch 连接参数
 * 创建 Elasticsearch 客户端实例
 * 获取嵌入维度
 * 定义 init_es 初始化函数
 * 检查 Elasticsearch 连接
 * 定义并创建 document_meta 索引
 * 定义并创建 chunk_info 索引
 * 初始化成功提示与返回
 * 调用初始化函数

#### 3. rag_api
 * **load_embdding_model**:  
加载编码模型
 * **load_rerank_model**:  
加载重排序模型
 * **split_text_with_overlap**:  
字符分割器，将文本按照Chunk Size和Overlap Size划分为chunk
 * **RAG**:  
RAG类，封装了RAG系统的核心逻辑
     * \_\_init__:  
    构造函数，初始化各种属性  
         * self.embedding_model:编码模型名称
         * self.rerank_model:重排序模型名称
         * self.use_rerank:是否使用重排序
         * self.embedding_dims:嵌入向量的维度
         * self.chunk_size:文本分块大小
         * self.chunk_overlap:文本分块重叠大小
         * self.chunk_candidate:候选chunk的数量
         * self.client:OpenAI 客户端实例
         * self.llm_model:llm模型名称
     * _extract_pdf_content:  
    pdf文档内容提取
     * _extract_word_content:
    word文档内容提取（未用）
     * extract_content:  
    公共方法，根据 file_type 决定调用哪个具体的提取方法（目前只处理 PDF）。
     * get_embedding:  
    对文本进行编码
     * get_rank:  
    对文本对进行重排序
     * query_document:  
    全文检索，指定一个知识库检索，bm25打分
     * chat_with_rag&chat:
    对话与 RAG 交互方法
     * query_parse&query_rewrite  
    占位符方法

#### 4. db_api
 * 数据库引擎创建逻辑
 * 定义 ORM 模型
 * 创建表并初始化 Session
#### 5. main
 * FastAPI 应用实例化
 * API 路由
     * GET /v1/knowledge_base:根据 knowledge_id 查询知识库信息。
     * DELETE /v1/knowledge_base:根据 knowledge_id 删除知识库。
     * POST /v1/knowledge_base:创建一个新的知识库。
     * GET /v1/document:根据 document_id 查询文档信息。
     * DELETE /v1/document:根据 document_id 删除文档。
     * POST /v1/document:上传并添加一个新文档到指定的知识库。
     * POST /v1/embedding:获取文本的语义嵌入向量。
     * POST /v1/rerank:对文本对进行语义重排序评分。
     * POST /chat:基于指定知识库进行 RAG 聊天。
 * 应用启动
 


